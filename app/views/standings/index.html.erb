<h1>Standings</h1>

<p><%= link_to("Schedule", schedule_path(@year, Week.current_week)) %></p>

<table>
  <thead>
    <tr>
      <th>Loser</th>
      <% @users.each do |user| %>
        <th><%= user.name %></th>
      <% end %>
    </tr>
    <tr>
      <th>Record</th>
      <% @users.each do |user| %>
        <th>
          <%= user.correct_picks_for(year: params[:year] || current_time.year).size %>
          -
          <%= user.strikes_for(year: params[:year] || current_time.year).size %>
        </th>
      <% end %>
    </tr>
    <tr>
      <th>Week</th>
      <th colspan="<%= @users.size %>">Picks</th>
    </tr>
  </thead>
  <tbody>
    <% @weeks.each do |week| %>
      <tr>
        <td><%= week.week %></td>
        <% @users.each do |user| %>
          <% pick = week.picks.detect { |pick| pick.user == user } %>
          <% matchup_class = "correct" if pick&.correct? %>
          <% matchup_class = "incorrect" if pick&.incorrect? %>
          <td class="<%= matchup_class %>">
            <% if pick %>
              <% if week.picks_locked?(current_time) %>
                <%= image_tag(pick.team.logo_url, alt: pick.team.initials, width: 22) %>
                <%= pick.team.initials %>
              <% else %>
                [HIDDEN]
              <% end %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
