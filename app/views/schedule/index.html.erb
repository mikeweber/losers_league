<h1>Week <%= @week.week %> of <%= @season.year %></h1>

<p>
  Picks are <%= @week.picks_locked?(@now) ? "locked" : "open" %> for this week.
</p>

<% if @week.week > 1 %>
  <%= link_to "Week #{@week.week - 1}", schedule_path(@season.year, @week.week - 1) %>
  |
<% end %>
Week <%= @week.week %>
<% if @week.week < 18 %>
  |
  <%= link_to "Week #{@week.week + 1}", schedule_path(@season.year, @week.week + 1) %>
<% end %>

<%= form_with model: @weekly_pick, url: picks_path, local: true do |form| %>
  <%= @weekly_pick.errors.full_messages.first if @weekly_pick.errors.any? %>
  <%= form.hidden_field(:year) %>
  <%= form.hidden_field(:week_num) %>
  <table>
    <thead>
      <tr>
        <th class="matchup_selector_col">
        <th>Kickoff</th>
        <th colspan="3">Home</th>
        <th colspan="3">Away</th>
      </tr>
    </thead>
    <tbody>
      <% @matchups.sort_by { _1.home.initials }.sort_by { _1.kickoff || Float::INFINITY }.each do |matchup| %>
        <tr>
          <td><%= matchup.kickoff&.strftime("%b %d @ %l:%M") || "TBD" %></td>

          <td>
            <% if @picks_allowed %>
              <%= form.radio_button(:loser_id, matchup.home_id, disabled: @week.picks_locked?(@now)) %>
            <% end %>
          </td>
          <td class="<%= "winning_team" if matchup.home_won? %>"><%= matchup.home.initials %></td>
          <td class="<%= "winning_team" if matchup.home_won? %>"><%= matchup.home_score %></td>

          <td>
            <% if @picks_allowed %>
              <%= form.radio_button(:loser_id, matchup.away_id, disabled: @week.picks_locked?(@now)) %>
            <% end %>
          </td>
          <td class="<%= "winning_team" if matchup.away_won? %>"><%= matchup.away.initials %></td>
          <td class="<%= "winning_team" if matchup.away_won? %>"><%= matchup.away_score %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @picks_allowed %>
    <%= submit_tag("Pick Loser") %>
  <% end %>
<% end %>
